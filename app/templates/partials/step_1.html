<div id="loadingOverlay"
    class="visually-hidden position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-75 d-flex align-items-center justify-content-center"
    style="z-index:1050">
    <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loadingâ€¦</span>
    </div>
</div>

<div id="step1-content" data-get-sync-function="syncData" data-get-unsaved-changes-flag="hasUnsavedChangesFlag"></div>
<div id="area1">
    <div class="container-fluid">
        <h2 class="h3 mb-4">Step 1: Develop a Conceptual Definition of the Construct</h2>

        <!-- Panel 1: Construct Name Input -->
        <div class="card mb-4" id="step1panel1">
            <div class="card-body">
                <h4 class="card-title mb-3">Construct Name</h4>
                <input type="text" class="form-control" id="constructName" name="constructName"
                    placeholder="e.g., Self-Efficacy, Job Satisfaction, Emotional Intelligence" maxlength="100">
                <div class="form-text text-muted mb-4">Enter the name of the psychological construct you want to
                    measure.</div>
                <h4 class="card-title mb-3">Rough Initial Definition</h4>
                <div class="mb-3">
                    <textarea class="form-control" id="initialDefinition" name="initialDefinition" rows="6"
                        placeholder="Describe what this construct represents, its key characteristics, and what it measures. For example: 'Self-efficacy refers to an individual's belief in their capacity to execute behaviors necessary to produce specific performance attainments.'"></textarea>
                    <div class="form-text text-muted">Provide a working definition that captures the essence of your
                        construct.</div>
                </div>
                <div class="row">
                    <div class="col-auto ms-auto">
                        <button class="btn btn-primary" id="saveContinueButton"
                            onclick="saveConstructData()" aria-label="Save and continue"
                            title="Save and continue" data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel 2: Compare Definitions -->
        <div class="card mb-4 d-none" id="step1panel2">
            <div class="card-body">
                <h4 class="card-title mb-3">Choose Definitions</h4>
                <!-- Container for displaying academic definitions as cards -->
                <div class="row my-3">
                    <div class="col-auto ms-auto p-0">
                        <button class="btn btn-outline-info" id="generateMoreButton"
                            onclick="getDefinitionsMore()" aria-label="Generate More" title="Generate More"
                            data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                    </div>
                    <div class="col-auto ps-2">
                        <button class="btn btn-outline-info" id="tryAgainButton"
                            onclick="getDefinitionsAgain()" aria-label="Generate New Definitions"
                            title="Generate New Definitions" data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div id="definitionsContainer" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3"></div>
                <div class="row my-3">
                    <div class="col-auto ms-auto">
                        <!-- button to choose selected definition -->
                        <button class="btn btn-primary d-none" id="chooseDefinitionButton"
                            onclick="chooseDefinition()" aria-label="Select Definition"
                            title="Select Definition" data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-check-lg"></i>
                        </button>
                        <!-- Button to merge Selected -->
                        <button class="btn btn-info d-none" id="mergeDefinitionsButton"
                            onclick="chooseDefinition()" aria-label="Merge Definitions"
                            title="Merge Definitions" data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-union"></i>
                        </button>
                    </div>
                </div>
                <div id="resultingDefinitionContainer" class="d-none">
                    <h4 class="card-title mb-3">Edit Your Definition</h4>
                    <textarea class="form-control my-3" id="resultingDefinitionTextarea" name="resultingDefinition"
                        rows="6"></textarea>
                        <div class="form-text text-muted">This can be refined later.</div>
                    <div class="row mb-3">
                        <!-- button to choose selected definition -->
                        <div class="col-auto ms-auto">
                            <button class="btn btn-primary" id="saveDefinitionButton"
                                onclick="saveDefinition()" aria-label="Save Definition"
                                title="Save Definition" data-bs-toggle="tooltip" data-bs-placement="top">
                                <i class="bi bi-floppy2 floppy-custom-color"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Panel 3: Conceptual Domain -->
        <div class="card mb-4 d-none" id="step1panel3">
            <div class="card-body">
                <h2 class="mb-4">Specify the Conceptual Domain</h2>
                <button class="btn btn-outline-info my-3" id="aiSuggestionButton"
                    onclick="getAISuggestion()" aria-label="Get AI Suggestion" title="Get AI Suggestion"
                    data-bs-toggle="tooltip" data-bs-placement="top">
                    <i class="bi bi-lightbulb"></i>
                </button>
                <div class="row mb-4 d-none" id="aiSuggestion">
                    <div class="container-fluid">
                        <div class="card text-bg-light">
                            <div class="card-body">
                                <div class="row">
                                    <p id="aiSuggestionText"></p>
                                </div>
                                <div class="row">
                                    <div class="col-auto ms-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeAISuggestion()">Take</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Conceptual Domain -->
                <div class="mb-4">
                    <label class="form-label fw-bold">1. What general type of property does your construct
                        represent?</label>
                    <div id="propertyOptions">
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Thought" id="propertyThought"><label class="form-check-label"
                                for="propertyThought">Thought (e.g., belief, intention)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Feeling" id="propertyFeeling"><label class="form-check-label"
                                for="propertyFeeling">Feeling (e.g., emotion, attitude)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Perception" id="propertyPerception"><label class="form-check-label"
                                for="propertyPerception">Perception (e.g., perceived usefulness)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Action" id="propertyAction"><label class="form-check-label"
                                for="propertyAction">Action (e.g., behavior, activity)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Outcome" id="propertyOutcome"><label class="form-check-label"
                                for="propertyOutcome">Outcome (e.g., performance, ROI)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Intrinsic Characteristic" id="propertyIntrinsic"><label class="form-check-label"
                                for="propertyIntrinsic">Intrinsic Characteristic (e.g., intelligence)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="property"
                                value="Other" id="propertyOther"><label class="form-check-label"
                                for="propertyOther">Other</label></div>
                    </div>
                    <textarea class="form-control mt-2" id="propertyExplanation" rows="2"
                        placeholder="If unsure or selected 'Other', explain here (optional)"></textarea>
                </div>

                <!-- Referent Entity -->
                <div class="mb-4">
                    <label class="form-label fw-bold">2. To what kind of entity does your construct apply?</label>
                    <div id="entityOptions">
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity"
                                value="Individual" id="entityIndividual"><label class="form-check-label"
                                for="entityIndividual">Individual</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity" value="Group"
                                id="entityGroup"><label class="form-check-label" for="entityGroup">Group / Team</label>
                        </div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity"
                                value="Organization" id="entityOrganization"><label class="form-check-label"
                                for="entityOrganization">Organization</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity"
                                value="Technology / Artifact" id="entityTech"><label class="form-check-label"
                                for="entityTech">Technology / Artifact</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity"
                                value="Situation / Task" id="entitySituation"><label class="form-check-label"
                                for="entitySituation">Situation / Task</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="entity" value="Other"
                                id="entityOther"><label class="form-check-label" for="entityOther">Other</label></div>
                    </div>
                    <textarea class="form-control mt-2" id="entityExplanation" rows="2"
                        placeholder="If unsure or selected 'Other', explain here (optional)"></textarea>
                </div>

                <!-- Submit -->
                <div class="row my-3">
                    <div class="col-auto ms-auto">
                        <button class="btn btn-primary" id="submitDomainButton" onclick="saveDomainData()"
                            aria-label="Select Conceptual Domain" title="Select Conceptual Domain"
                            data-bs-toggle="tooltip" data-bs-placement="top">
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Panel 4 -->
        <div class="card mb-4 d-none" id="step1panel4">
            <div class="card-body">
                <h3 class="mb-4">Specify the Conceptual Theme</h3>
                <!-- Panel 4: Conceptual Theme Inputs -->
                <!-- AI Suggestion for Theme -->
                <button class="btn btn-outline-info my-3" id="aiThemeSuggestionButton"
                    onclick="getThemeAISuggestion()" aria-label="Get AI Theme Suggestion"
                    title="Get AI Theme Suggestion">
                    <i class="bi bi-lightbulb"></i>
                </button>
                <div class="row mb-4 d-none" id="aiThemeSuggestion">
                    <div class="container-fluid">
                        <div class="card text-bg-light">
                            <div class="card-body">
                                <div class="row">
                                    <p id="aiThemeSuggestionText"></p>
                                </div>
                                <div class="row">
                                    <div class="col-auto ms-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeThemeAISuggestion(false,true)"
                                            title="Append the generated attributes"  data-bs-custom-class="custom-tooltip" data-bs-toggle="tooltip" data-bs-placement="top"
                                            >Add Attributes</button>
                                    </div>
                                    <div class="col-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeThemeAISuggestion(true)"
                                            title="Fill in the theme input fields" data-bs-custom-class="custom-tooltip" data-bs-toggle="tooltip" data-bs-placement="top"
                                            >Fill</button>
                                    </div>
                                    <div class="col-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeThemeAISuggestion()"
                                            title="Use the Suggested Theme" data-bs-custom-class="custom-tooltip" data-bs-toggle="tooltip" data-bs-placement="top">Take</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <h5 class="form-label fw-bold">
                        Attributes
                        <i class="bi bi-info-circle text-muted ms-2 " data-bs-toggle="tooltip" data-bs-placement="top"
                            data-bs-html="true" data-bs-custom-class="custom-tooltip" data-bs-theme="dark" title="<h5>Classification</h5><p><ul class='list-unstyled mb-2'>
<li><strong>Common</strong>: shared by many similar or related constructs.</li>
<li><strong>Unique</strong>: distinctively associated with this construct.</li>
<li><strong>Both</strong>: partly shared and partly distinct.</li>
<li><strong>Neither</strong>: not clearly diagnostic.</li>
</ul></p>
<h5>Indication</h5><ul class='list-unstyled mb-2'>
<li><strong>Necessary</strong>: the construct <strong>cannot exist without</strong> this attribute.</li>
<li><strong>Sufficient</strong>: this attribute <strong>alone guarantees</strong> the construct.</li>
<li><strong>Both</strong>: both necessary and sufficient.</li>
<li><strong>Neither</strong>: helpful but not essential or definitive.</li>
</ul>
<h5>Core</h5>
<p>If all core attributes are present, the construct exists; however, if any of these is missing, the construct is incomplete.</p>

"></i>
                    </h5>
                        <div id="attributesContainer"></div>
                        <button class="btn btn-outline-secondary" type="button" id="addAttributeButton">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                </div>

                <div class="mb-5">
                    <h5 class="form-label fw-bold">Breadth and Inclusiveness</h5>
                    <textarea class="form-control" id="breadthInclusivenessInput" rows="3"
                        placeholder="Describe the breadth and inclusiveness of the construct"></textarea>
                </div>

                <div class="mb-5">
                    <h5 class="form-label fw-bold">Dimensionality</h5>
                    <div id="dimensionalityOptions">
                        <div class="form-check"><input class="form-check-input" type="radio" name="dimensionality"
                                id="dimUnidimensional" value="Unidimensional"><label class="form-check-label"
                                for="dimUnidimensional">Unidimensional</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="dimensionality"
                                id="dimMultidimensional" value="Multidimensional"><label class="form-check-label"
                                for="dimMultidimensional">Multidimensional</label></div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5 class="form-label fw-bold">Stability</h5>
                    <div class="mb-3">
                        <label class="form-label">Over Time:</label>
                        <div class="card" style="width: fit-content;">
                            <div class="card-boy p-2">
                                <div class="d-grid gap-2 d-md-flex justify-content-start" role="group"
                                    aria-label="Stability Over Time">
                                    <input type="radio" class="btn-check" name="stabilityTime" id="stableTrait"
                                        autocomplete="off" value="Stable (trait-like)">
                                    <label class="btn" for="stableTrait">Stable (trait-like)</label>
                                    <input type="radio" class="btn-check" name="stabilityTime" id="variableState"
                                        autocomplete="off" value="Variable (state-like)">
                                    <label class="btn" for="variableState">Variable (state-like)</label>
                                    <input type="radio" class="btn-check" name="stabilityTime" id="timeDepends"
                                        autocomplete="off" value="Depends / Not sure">
                                    <label class="btn" for="timeDepends">Depends / Not sure</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Across Situations:</label>
                        <div class="card" style="width: fit-content;">
                            <div class="card-boy p-2">
                                <div class="d-grid gap-2 d-md-flex justify-content-start" role="group"
                                    aria-label="Stability Across Situations">
                                    <input type="radio" class="btn-check" name="stabilitySituation"
                                        id="situationGeneralizable" autocomplete="off" value="Generalizable">
                                    <label class="btn" for="situationGeneralizable">Generalizable</label>
                                    <input type="radio" class="btn-check" name="stabilitySituation"
                                        id="situationSpecific" autocomplete="off" value="Situation-specific">
                                    <label class="btn" for="situationSpecific">Situation-specific</label>
                                    <input type="radio" class="btn-check" name="stabilitySituation"
                                        id="situationDepends" autocomplete="off" value="Depends / Not sure">
                                    <label class="btn" for="situationDepends">Depends / Not sure</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Across Cases:</label>
                        <div class="card" style="width: fit-content;">
                            <div class="card-body p-2">
                                <div class="d-grid gap-2 d-md-flex justify-content-start" role="group"
                                    aria-label="Stability Across Cases">
                                    <input type="radio" class="btn-check" name="stabilityCases" id="casesBroadly"
                                        autocomplete="off" value="Broadly applicable">
                                    <label class="btn" for="casesBroadly">Broadly applicable</label>
                                    <input type="radio" class="btn-check" name="stabilityCases" id="casesSubgroups"
                                        autocomplete="off" value="Applies only to specific subgroups">
                                    <label class="btn" for="casesSubgroups">Applies only to specific subgroups</label>
                                    <input type="radio" class="btn-check" name="stabilityCases" id="casesDepends"
                                        autocomplete="off" value="Depends / Not sure">
                                    <label class="btn" for="casesDepends">Depends / Not sure</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row my-3">
                    <div class="col-auto ms-auto">
                        <button class="btn btn-primary" id="saveThemeButton" onclick="saveTheme()"><i
                                class="bi bi-check-lg"></i></button>
                    </div>
                </div>

            </div>
        </div> <!-- end of panel 4 -->

        <!-- Panel 5: Subdimensions -->
        <div class="card mb-4 d-none" id="step1panel5">
            <div class="card-body">
                <h3 class="mb-4">Specify Subdimensions</h3>
                <p>Define subdimensions for your construct. For each subdimension, provide a name, definition, and
                    attributes.</p>
                <!-- AI Suggestion for Subdimensions -->
                <button class="btn btn-outline-info my-3" id="aiSubdimSuggestionButton"
                    onclick="getSubdimAISuggestion()" aria-label="Get AI Subdimensions Suggestion"
                    title="Get AI Subdimensions Suggestion">
                    <i class="bi bi-lightbulb"></i>
                </button>
                <div class="row mb-4 d-none" id="aiSubdimSuggestion">
                    <div class="container-fluid">
                        <div class="card text-bg-light">
                            <div class="card-body">
                                <div class="row">
                                    <p id="aiSubdimSuggestionText"></p>
                                </div>
                                <div class="row">
                                    <div class="col-auto ms-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeSubdimAISuggestion(false)">Add</button>
                                    </div>
                                    <div class="col-auto">
                                        <button class="btn btn-outline-secondary"
                                            onclick="takeSubdimAISuggestion()">Take</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="subdimensionsContainer"></div>
                <button class="btn btn-outline-secondary" type="button" id="addSubdimensionButton">
                    <i class="bi bi-plus-lg"></i> Add Subdimension
                </button>
                <div class="row my-3">
                    <div class="col-auto ms-auto">
                        <button class="btn btn-primary" id="saveSubdimensionsButton"
                            onclick="saveSubdimensions()"><i class="bi bi-check-lg"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- after the end of Panel 5 markup, just before closing the form or container -->
        <div class="d-flex justify-content-end">
            <button id="continueStep1Btn" type="button" class="btn btn-primary d-none my-3">
                Continue to Next Step
            </button>
        </div>
    </div>